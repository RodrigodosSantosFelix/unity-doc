! メカニム パフォーマンスおよび最適化 / Mecanim Performance and Optimization

!! プレイヤー キャラクターのボーンに要素をアタッチする場合、要素の数が多いことでフレームレートの問題を引き起こすことがありますか？

追加のボーンにアニメーションがない場合であればコストは無視出来ます。それ以外の場合は、Generic モードにおいて、追加したボーンの数に比例したコストがかかります（すなわち既に 30 のボーンがあるリグに 15 のボーンを追加すると 50% 余分に時間がかかります）。 ''Generic および Humanoid モードのいずれでも追加のボーンを保有することがあることに留意にして下さい。''

!! アニメータでの別レイヤーにかかるコストはどれぐらいですか？（同期または非同期）

メカニムでかかる時間のほとんどはアニメーションの評価にかかります。レイヤー / ステートマシンによるオーバーヘッドは極力小さくなるように設計しています。このため、実際にはどういうアニメーションツリー / ブレンドツリーがレイヤー上で再生されるかに依存します。

!! レイヤーのウェイトをゼロにしてもコストはかかりますか？

Unity が全ての演算をスキップするわけではありませんが、最も高価な演算はスキップします。

!! コントローラがセットされてない場合も アニメーターは CPU を消費しますか？

いえ、4.1以降は使用しません。

!! メカニムを使ったシーンの最適化はどうすれば良いですか？

最適化の方法は様々ですが、便利なテクニックとしては:

文字列の代わりにハッシュを使用してアニメーターにクエリをかけます。

* 小規模の AI レイヤーを実装してアニメーターを制御します。OnStateChange, OnTransitionBegin, その他で簡単なコールバックを提供させることが出来ます。
* 'State Tags' を使用して自身の AI ステートマシンをメカニムのステートマシンと簡単に一致させることが出来ます。
* イベントをシミュレートするための追加のカーブを使用します。
* 追加のカーブを使用してアニメーションをマークアップします。 (例えばMatchTarget に対して http://docs.unity3d.com/Documentation/Manual/TargetMatching.html )

!! 簡単なアニメーションのパフォーマンス

現時点では単独のブレンドのないアニメーションがクリップを再生する場合、メカニムのオーバーヘッドが原因で、メカニムは旧アニメーション システムより遅いことがあります。旧アニメーション システム は非常に直接的でカーブのサンプリングをして transform に直接書き込みをしていました。メカニムではブレンドに一時バッファがあり、現時点ではカーブデータのサンプリングその他にら追加のデータコピー作業があります。単独のアニメーションクリップでは旧アニメーションシステムが良く動作するという状況です。

反対にメカニムレイアウトはアニメーションのブレンドおよび複雑な設定がある場合に最適化されています。

単独のアニメーションクリップの再生でのメカニムの最適化はわれわれの今後の検討課題です。

!! Humanoid 対 Generic パフォーマンス

IK パスおよび Foot IK がアニメーション ステートで有効化されている前提: Generic メカニム モードがより良いパフォーマンスが得られます。

Generic を使用するとき、root motion を 使用することは root motion を使用しない場合に比べて高価です。もしアニメーションが root motion を使用しない場合は root ボーンを全く選択してないことをチェックします。

Android 上では、現時点ではさらにパフォーマンスが悪化し、これは NEON か行われないためです。特にHumanoid モードは数値計算が大量にあり、NEON なしでは 2 倍から 2.5 倍ほど遅くなる状況が容易に発生します。iOS / Androidで見られるパフォーマンスの差分はこれで説明がつきます。

!! スケールしたカーブは使用しない

アーティストは値を変化させないスケールしたカーブを使用することがあります。そういう状況がないことを二重チェックして下さい。どのアニメーションクリップでも単独のスケールしたカーブがないことを確認して下さい。

最善の方法はアセットポストプロセッサにより取り除くか警告が出るようにすることです。

!! スキンメッシュは可能なかぎりまとめる

自身のキャラクターに二つのスキンメッシュ レンダラがあり、各々に3つのマテリアルごあるとします。キャラクターを二つのスキンメッシュ レンダラに分割するのはパフォーマンス観点では良くありません。もう一つ別のマテリアルがあったほうが良いです。

1 つのマテリアルであるのがベストですが、アーティストからすると2 つのマテリアルが必要な場合が多いです。
