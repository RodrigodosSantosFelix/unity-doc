! アニメーション ステートマシン / Animation State Machines

キャラクターが行うことのできるいくつかのアニメーションに対応して複数のアニメーションがあるのは一般的です。例えば、アイドルのとき、歩行のときに指定されたタイミング呼吸や揺れたり、プラットフォームから落ちるときにパニックになって、腕を上にあげるといったとがあります。スクリプティング作業として、アニメーションがいつプレイバックされるかを制御するのは潜在的にかなり複雑なことです。メカニムはコンピュータ科学における $$State Machine$$ （ステートマシン）という概念を借用して、 キャラクターのアニメーションの制御と順序づけを単純化します。

!!ステートマシンの基礎

基本的な考え方はキャラクターが特定のタイミングで何らかのアクションに従事している、ということです。利用可能なアクションはゲームの種類に依存しますが、アイドル、歩く、走る、ジャンプ、などが典型的なアクションに含まれます。これらのアクションは、キャラクターが何らかの歩く、アイドル、または何かの状態（ステート）であることに起因して $$State$$ （ステート）と呼ばれます。一般に、キャラクターの次に移れるステートについては制限があり、いきなり自由にどれかのステートからどれかへ自由に移れるわけではありません。キャラクターが現在のステートから次に移れるステートの選択肢を $$State Transition$$ （ステート遷移）と呼ばれます。ステートのセット、遷移のセット、および現在のステートを格納する変数のセットを合わせて、$$State Machine$$ （ステートマシン）が形成されます。

ステートマシンのステートおよび遷移はグラフ図を用いて表現することが出来て、ノードがステートを表し、ノードを結ぶ矢印が遷移を表します。現在のステートをノードの上での、現在地のマーカーまたは、ハイライトされた場所としてとらえるのが良く、矢印に沿ってしか次のノードに移ることが出来ません。

Attach:StateMachineDiagram.png

アニメーションにおいてステートマシンが重要であることがは、コーディングをあまりすることなく、設計および更新をすることがかなり容易であることです。各ステートにはアニメーション シーケンスが付属していて、そのステートにあるときに再生されます。これによりアニメーション専門スタッフまたはデザイナーが、コードがどのように動作するか考えることなく、利用可能なキャラクター アクションおよびアニメーションの順序を定義することが出来ます。

!!メカニム ステートマシン
メカニムのアニメーションでのステートマシンにより、ある特定のキャラクターの全てのアニメーションクリップの全体像を捉えることができ、そこからゲームにおける様々なイベント（例えばユーザ入力）によって異なるアニメーションをトリガーすることを可能にします。


アニメーション ステートマシンは [[Animator|アニメータ コントローラ ウィンドウ]] から設定することができ、次のように表示されます：

Attach:MecanimStateMachine.png

 ステートマシンは $$States$$ 、 $$Transitions$$ 、 $$Events$$ 、および大きなステートマシンのコンポーネントに使用できる、より小さなサブステートマシンから構成されます。

(:tocportion:)

([[MecanimAnimationSystem|メカニム入門]] に戻る)
